(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[296],{2520:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/add-listing",function(){return i(1583)}])},1583:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return _}});var s=i(5893),a=i(7294),r=i(5616),n=i(1903),o=i(4054),c=i(3841),l=i(315),d=i(431),p=i(629),h=i(5861),u=i(6886),m=i(3946),x=i(5582),g=i(6624),j=i(4472),Z=i(3578),f=i(9417),b=i(8456),y=i(5970),v=i(1737),w=i(8901),k=i(1733),P=i(5675),C=i.n(P);let S=["Basic Information","Category Selection","Upload Images","Upload Assets","Review and Submit"];var N=()=>{let[e,t]=(0,a.useState)({id:"",name:"",description:"",price:0,stock:0,category:"",images:[],assets:[],rating:0,new:!0,brand:"",type:"physical",inStock:!0,reviews:[]}),[i,P]=(0,a.useState)([]),[N,_]=(0,a.useState)(!1),[D,I]=(0,a.useState)(0),[E,F]=(0,a.useState)(null),[R,O]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=async()=>{try{let e=await fetch("https://api.local.ritualworks.com/api/products/categories");if(!e.ok)throw Error("Failed to fetch categories");let t=await e.json();P(t)}catch(e){F("Failed to fetch categories. Please try again.")}};e()},[]);let W=i=>{let{name:s,value:a}=i.target;t({...e,[s]:a})},A=(i,s)=>{let a=i.map(e=>L(e,s));Promise.all(a).then(i=>{"image"===s?t({...e,images:[...e.images,...i]}):t({...e,assets:[...e.assets,...i]})}).catch(e=>F("Failed to upload ".concat(s,"s: ").concat(e.message)))},{getRootProps:T,getInputProps:q}=(0,w.uI)({onDrop:e=>A(e,"image"),accept:{"image/*":[]}}),{getRootProps:z,getInputProps:B}=(0,w.uI)({onDrop:e=>A(e,"asset"),accept:{"application/pdf":[],"application/msword":[],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[],"application/zip":[],"application/x-rar-compressed":[]}}),U=i=>{let s=e.images.filter((e,t)=>t!==i);t({...e,images:s})},X=i=>{let s=e.assets.filter((e,t)=>t!==i);t({...e,assets:s})},H=async t=>{t.preventDefault(),_(!0);try{let t=await fetch("https://api.local.ritualworks.com/api/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to submit the product");I(S.length),O(!0)}catch(e){F("Failed to submit the product. Please try again.")}finally{_(!1)}},J=()=>{O(!1)},L=async(e,t)=>{let i=Math.ceil(e.size/5242880),s=e.name,a="";for(let r=0;r<i;r++){let n=e.slice(5242880*r,(r+1)*5242880),o=new FormData;o.append("file",n),o.append("chunkIndex",r.toString()),o.append("totalChunks",i.toString()),o.append("fileName",s),o.append("username","your-username"),o.append("productId","your-product-id"),o.append("type",t);let c=await fetch("https://api.local.ritualworks.com/api/assets/upload-chunk",{method:"POST",body:o});if(!c.ok)throw Error("Failed to upload chunk ".concat(r+1,"/").concat(i));if(r===i-1){let e=await c.json();a=e.FileName}}return a};return(0,s.jsx)(x.Z,{maxWidth:"md",children:(0,s.jsxs)(r.Z,{sx:{mt:3},children:[(0,s.jsx)(h.Z,{variant:"h4",gutterBottom:!0,children:"Add New Product"}),(0,s.jsx)(g.Z,{activeStep:D,alternativeLabel:!0,children:S.map((e,t)=>(0,s.jsx)(j.Z,{completed:D>t,children:(0,s.jsx)(Z.Z,{children:e})},e))}),(0,s.jsxs)(r.Z,{component:"form",onSubmit:H,sx:{mt:3},children:[(()=>{switch(D){case 0:return(0,s.jsxs)(r.Z,{children:[(0,s.jsx)(n.Z,{required:!0,fullWidth:!0,id:"name",label:"Product Name",name:"name",value:e.name,onChange:W,sx:{mb:2}}),(0,s.jsx)(n.Z,{required:!0,fullWidth:!0,multiline:!0,minRows:3,id:"description",label:"Description",name:"description",value:e.description,onChange:W,sx:{mb:2}}),(0,s.jsx)(n.Z,{required:!0,fullWidth:!0,id:"price",label:"Price",name:"price",type:"number",value:e.price,onChange:W,sx:{mb:2}}),(0,s.jsx)(n.Z,{required:!0,fullWidth:!0,id:"stock",label:"Stock",name:"stock",type:"number",value:e.stock,onChange:W,sx:{mb:2}})]});case 1:return(0,s.jsxs)(o.Z,{fullWidth:!0,sx:{mb:2},children:[(0,s.jsx)(c.Z,{id:"category-label",children:"Category"}),(0,s.jsx)(l.Z,{labelId:"category-label",id:"category",name:"category",value:e.category,onChange:W,label:"Category",children:i.map(e=>(0,s.jsx)(d.Z,{value:e.id,children:e.name},e.id))})]});case 2:return(0,s.jsxs)(r.Z,{children:[(0,s.jsxs)(p.Z,{variant:"outlined",...T(),sx:{padding:2,borderColor:"primary.main",borderRadius:1,textAlign:"center",cursor:"pointer",mb:2},children:[(0,s.jsx)("input",{...q()}),(0,s.jsx)(h.Z,{children:"Drag & drop images here, or click to select files"})]}),(0,s.jsx)(u.ZP,{container:!0,spacing:2,children:e.images.map((e,t)=>(0,s.jsx)(u.ZP,{item:!0,xs:12,sm:6,children:(0,s.jsxs)(r.Z,{sx:{position:"relative"},children:[(0,s.jsx)(C(),{src:e,alt:"Product image ".concat(t+1),width:500,height:500}),(0,s.jsx)(m.Z,{sx:{position:"absolute",top:0,right:0},onClick:()=>U(t),children:(0,s.jsx)(k.Z,{})})]})},t))})]});case 3:return(0,s.jsxs)(r.Z,{children:[(0,s.jsxs)(p.Z,{variant:"outlined",...z(),sx:{padding:2,borderColor:"primary.main",borderRadius:1,textAlign:"center",cursor:"pointer",mb:2},children:[(0,s.jsx)("input",{...B()}),(0,s.jsx)(h.Z,{children:"Drag & drop assets here, or click to select files"})]}),(0,s.jsx)(u.ZP,{container:!0,spacing:2,children:e.assets.map((e,t)=>(0,s.jsx)(u.ZP,{item:!0,xs:12,sm:6,children:(0,s.jsxs)(r.Z,{sx:{position:"relative"},children:[(0,s.jsx)(h.Z,{children:e}),(0,s.jsx)(m.Z,{sx:{position:"absolute",top:0,right:0},onClick:()=>X(t),children:(0,s.jsx)(k.Z,{})})]})},t))})]});case 4:var t;return(0,s.jsxs)(r.Z,{children:[(0,s.jsx)(h.Z,{variant:"h6",children:"Review and Submit"}),(0,s.jsxs)(h.Z,{children:["Name: ",e.name]}),(0,s.jsxs)(h.Z,{children:["Description: ",e.description]}),(0,s.jsxs)(h.Z,{children:["Price: $",e.price]}),(0,s.jsxs)(h.Z,{children:["Stock: ",e.stock]}),(0,s.jsxs)(h.Z,{children:["Category: ",null===(t=i.find(t=>t.id===e.category))||void 0===t?void 0:t.name]}),e.images.length>0&&(0,s.jsxs)(r.Z,{sx:{mt:2},children:[(0,s.jsx)(h.Z,{children:"Images:"}),(0,s.jsx)(u.ZP,{container:!0,spacing:2,children:e.images.map((e,t)=>(0,s.jsx)(u.ZP,{item:!0,xs:12,sm:6,children:(0,s.jsx)(C(),{src:e,alt:"Product image ".concat(t+1),width:500,height:500})},t))})]}),e.assets.length>0&&(0,s.jsxs)(r.Z,{sx:{mt:2},children:[(0,s.jsx)(h.Z,{children:"Assets:"}),(0,s.jsx)(u.ZP,{container:!0,spacing:2,children:e.assets.map((e,t)=>(0,s.jsx)(u.ZP,{item:!0,xs:12,sm:6,children:(0,s.jsx)(h.Z,{children:e})},t))})]})]});default:return null}})(),E&&(0,s.jsx)(h.Z,{color:"error",sx:{mt:2},children:E}),(0,s.jsxs)(r.Z,{sx:{display:"flex",justifyContent:"space-between",mt:2},children:[(0,s.jsx)(f.Z,{disabled:0===D,onClick:e=>{e.preventDefault(),I(e=>e-1)},sx:{mr:2},children:"Back"}),D===S.length-1?(0,s.jsx)(f.Z,{variant:"contained",color:"primary",type:"submit",disabled:N,children:N?(0,s.jsx)(b.Z,{size:24}):"Submit"}):(0,s.jsx)(f.Z,{variant:"contained",color:"primary",onClick:e=>{e.preventDefault(),I(e=>e+1)},children:"Next"})]})]}),(0,s.jsx)(y.Z,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:R,autoHideDuration:3e3,onClose:J,children:(0,s.jsxs)(v.Z,{onClose:J,severity:"success",children:["Product ",e.id?"updated":"added"," successfully!"]})})]})})},_=()=>(0,s.jsx)(x.Z,{children:(0,s.jsxs)(r.Z,{sx:{my:4},children:[(0,s.jsx)(h.Z,{variant:"h3",component:"h1",gutterBottom:!0}),(0,s.jsx)(N,{})]})})}},function(e){e.O(0,[903,260,454,121,774,888,179],function(){return e(e.s=2520)}),_N_E=e.O()}]);